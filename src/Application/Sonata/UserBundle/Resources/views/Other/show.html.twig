{% extends "::base.html.twig" %}
{% trans_default_domain "ApplicationSonataUserBundle" %}
{% spaceless %}
    {% set wearesocial = true %} 
    {% block title %}
        {%if user.firstname is not null and user.lastname is not null%}
            {{user.firstname ~ ' ' ~ user.lastname}}
        {%else%}
            {{user.username}}
        {%endif%} - {{ parent() }}
    {% endblock %}

    {% block stylesheets %} 
        {% stylesheets 'bundles/teacampuscommon/css/bootstrap-tagsinput.css' filter='cssrewrite'%}
        <link rel="stylesheet" href="{{ asset_url }}" />
        {% endstylesheets %}
    {% endblock %}

    {% block main_content %}
        <section class="about-me-header">
            <div class="container">	
                <div class="row">
                    <div class="col-md-6 wow fadeInUp" data-wow-duration="2s" >
                        <h1 class="title">
                            {%if user.firstname is not null and user.lastname is not null%}
                                {{user.firstname ~ ' ' ~ user.lastname}}
                            {%else%}
                                {{user.username}}
                            {%endif%}
                        </h1>
                        <div class="path pull-right">
                            {%if user.biography is not null%}
                                {{user.biography}}
                            {%else%}
                                {{ 'profile.member_since'| trans({},'messages') }}&nbsp;
                                {{user.createdAt|format_date('dd MMMM Y', 'fr', 'Europe/Paris', constant('IntlDateFormatter::LONG'))}}
                            {%endif%}
                        </div>
                    </div>
                    <div class="col-md-6 wow fadeInUp" data-wow-duration="2s" >
                        <div class="avatar">
                            {% if user.avatar is not null %}
                                {% thumbnail user.avatar, 'square' with{} %}
                            {% else %}
                                {% image '@TeaCampusCommonBundle/Resources/public/images/unknown.png'  output="images/avatar.jpg" %}
                                <img src="{{ asset_url }}">
                                {% endimage %}
                            {% endif %}
                            &nbsp;<a href="#new_message" class="btn btn-warning btn-short ajax-delete" aria-controls="new_message" role="tab" data-toggle="tab"><i class="fa fa-paper-plane"></i>&nbsp;{% trans from 'FOSMessageBundle' %}send_new{% endtrans %}</a>

                        </div>
                    </div>
                    <div id="new_message" class="mfp-hide mfp-small-dialog">
                        <h1>{{ 'message.show.new'|trans({}, 'messages') }}</h1>
                        <div class="row">
                            <div class="row-same-height" id="message-form-container">
                                <form action="{{ url('fos_message_thread_new') }}" method="post" id="new-message-form">
                                    {{ form_start(form) }}
                                    {{ form_errors(form) }}
                                    <div style="margin-bottom: 10px;display: none">{{ form_widget(form.recipient, { 'attr': {'placeholder': 'form.recipe'|trans({},'messages'), 'type': 'text','value' : user.username,'class':'form-control','style':'background-color:#fff'} }) }}</div>
                                    <div style="margin-bottom: 10px">{{ form_widget(form.subject, { 'attr': {'placeholder': 'form.subject'|trans({},'messages'),'class':'form-control','style':'background-color:#fff'} }) }}</div>
                                    <div style="margin-bottom: 10px">{{ form_widget(form.body, { 'attr': {'placeholder': 'form.body'|trans({},'messages'), 'type': 'textarea','class':'form-control','style':'background-color:#fff'} }) }}</div>
                                    <input class="contact_button button btn btn-primary btn-block" style="margin-bottom: 10px" type="submit" />
                                    {{ form_end(form) }}
                                </form>
                            </div><!--row same height-->
                        </div><!--row-->
                        <button title="Close (Esc)" type="button" class="mfp-close">Ã—</button>
                    </div>
                </div><!--row-->
            </div><!--container-->
        </section> 
        <!-- Profil - Tabs -->
        <!-- ++++++++++++++++++++++++++++++++++++++++ -->
        <section  class="profil-tabs wrap-contacts">
            <div class="container container-tabs">
                <div class="anchor-icon"><i class="fa fa-user"></i></div>
                <!-- Nav tabs -->
                <ul id="user-profil-tabs" class="nav  nav-tabs-alt nav-tabs-two nav-tab-inverse" role="tablist">
                    <li role="presentation" class="active"><a href="#infos" aria-controls="infos" role="tab" data-toggle="tab"><i class="fa fa-info-circle"></i>&nbsp;&nbsp;{{ 'othertabs.infos.title'| trans({},'messages') }}</a></li>
                    <li role="presentation"><a href="#videos" aria-controls="videos" role="tab" data-toggle="tab"><i class="fa fa-play-circle"></i>&nbsp;&nbsp;{{ 'othertabs.videos.title'| trans({},'messages') }}</a></li>
                    <li role="presentation"><a href="#projets" aria-controls="projets" role="tab" data-toggle="tab"><i class="fa fa-file-o"></i>&nbsp;&nbsp;{{ 'othertabs.projects.title'| trans({},'messages') }}</a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">

                    <!--  Info -->
                    <!-- ++++++++++++++++++++++++++++++++++++++++ -->
                    <div role="tabpanel" class="tab-pane active" id="infos">
                        <div class="row">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="footer-header">	
                                    <h2>{{ 'othertabs.infos.title'| trans({},'messages') }}</h2>
                                </div>
                            </div>				
                        </div><!--row-->
                        <div class="row tabpanel-content">
                            {{ include( 'ApplicationSonataUserBundle:Other:Tabs/infos.html.twig') }}
                        </div>
                    </div><!--tabpanel-->

                    <!-- Mes videos -->
                    <!-- ++++++++++++++++++++++++++++++++++++++++ -->
                    <div role="tabpanel" class="tab-pane" id="videos">
                        <div class="row">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="footer-header">	
                                    <h2>{{ 'othertabs.videos.title'| trans({},'messages') }}</h2>
                                </div>	
                            </div>				
                        </div><!--row-->
                        <div class="row tabpanel-content">
                            {{ include( 'ApplicationSonataUserBundle:Other:Tabs/videos.html.twig') }}
                        </div>
                    </div><!--tabpanel-->

                    <!-- Mes projets -->
                    <!-- ++++++++++++++++++++++++++++++++++++++++ -->
                    <div role="tabpanel" class="tab-pane" id="projets">
                        <div class="row">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="footer-header">	
                                    <h2>{{ 'othertabs.projects.title'| trans({},'messages') }}</h2>
                                </div>
                            </div>				
                        </div><!--row-->
                        <div class="row tabpanel-content" id="project-list">
                            {{ include( 'ApplicationSonataUserBundle:Other:Tabs/projects.html.twig') }}
                        </div>
                    </div><!--tabpanel-->

                </div><!--tab-content-->

            </div><!--container-->



        </section>
    {% endblock %}

    {% block scripts %}

        <script>
            $('.ajax-popup-link').magnificPopup({
                closeBtnInside: true,
                midClick: true,
                type: 'ajax'
            });

            $('.ajax-delete').magnificPopup({
                type: 'inline',
                modal: true
            });
            $(document).on('click', 'a.delete-button', function (e) {
                e.preventDefault();
                var li = $(this).attr('data-li');
                $.ajax({
                    url: $(this).attr('href'),
                    dataType: "json",
                    data: {id: $(this).attr('data-id')},
                    type: 'POST'
                })
                        .done(function (data) {
                            $.magnificPopup.close();
                            if (data['success']) {
                                $("#" + li).fadeOut(700, function () {
                                    $(this).remove();
                                });
                            } else {
                                alert("{{ 'projet.delete.error'| trans({},'messages') }}");
                            }

                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {
                            console.log(textStatus, errorThrown);
                        });
            });
            $(document).on('click', 'a.delete-button', function (e) {
                e.preventDefault();
                var li = $(this).attr('data-li');
                $.ajax({
                    url: $(this).attr('href'),
                    dataType: "json",
                    data: {id: $(this).attr('data-id')},
                    type: 'POST'
                })
                        .done(function (data) {
                            $.magnificPopup.close();
                            if (data['success']) {
                                $("#" + li).fadeOut(700, function () {
                                    $(this).remove();
                                });
                            } else {
                                alert("{{ 'projet.delete.error'| trans({},'messages') }}");
                            }

                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {
                            console.log(textStatus, errorThrown);
                        });
            });

            $(document).on('click', '.popup-modal-dismiss', function (e) {
                e.preventDefault();
                $.magnificPopup.close();
            });

            $(document).ready(function () {
                $("#new-message-form").submit(function (e) {
                    e.preventDefault();
                    $('#message-form-container').html('<br><br><span style="color:black">{{ 'contact.loading'| trans({},'messages') }}</span><br><i style="color:white" class="fa fa-spin fa-spinner fa-2x"></i><br>');
                    $('#new_message').find('h1').html('');
                    $.ajax({
                        url: $(this).attr('action'),
                        dataType: "json",
                        data: $(this).serialize(),
                        type: 'POST'
                    })
                            .done(function (data) {
                                if (data['success']) {
                                    $('#message-form-container').html('<div style="margin-top:30px" class="alert alert-success"> {{ 'contact.sent'| trans({},'messages') }}</div>');
                                } else {
                                    $('#message-form-container').html('<div class="alert alert-danger"> {{ 'contact.error'| trans({},'messages') }}</div>');
                                }
                            })
                            .fail(function (jqXHR, textStatus, errorThrown) {
                                console.log(textStatus, errorThrown);
                            });
                });
            });

        </script>
        {% block messageScripts %}
        {% endblock %}
        {% block newMessageScripts %}
        {% endblock %}
    {% endblock %}
{% endspaceless %}